--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
-- ATMOSPHERE - http://www.atmosphere-eubrazil.eu/
-- 
-- 
-- Trustworthiness Monitoring & Assessment Framework
-- Component: Knowledge - database
-- 
-- Repository: https://github.com/eubr-atmosphere/tma-framework
-- License: https://github.com/eubr-atmosphere/tma-framework/blob/master/LICENSE
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--
-- Raw file as generated by astah. 
-- Check TMA-K_create_database.sql for the normalized MySQL version.
--
--
-- @author Jos√© Pereira <josep@dei.uc.pt>
-- @author Nuno Antunes <nmsa@dei.uc.pt>
-- 
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

DROP TABLE Actuator CASCADE CONSTRAINTS;
CREATE TABLE Actuator (
 actuatorId INT NOT NULL PRIMARY KEY,
 address VARCHAR(1024),
 pubKey VARCHAR(1024)
);


DROP TABLE Description CASCADE CONSTRAINTS;
CREATE TABLE Description (
 descriptionId INT NOT NULL PRIMARY KEY,
 dataType CHAR(16),
 descriptionName CHAR(128),
 unit CHAR(16)
);


DROP TABLE Probe CASCADE CONSTRAINTS;
CREATE TABLE Probe (
 probeId INT NOT NULL PRIMARY KEY,
 probeName VARCHAR(128),
 password VARCHAR(128),
 salt VARCHAR(128) NOT NULL,
 token VARCHAR(256),
 tokenExpiration TIMESTAMP(6)
);


DROP TABLE QualityModel CASCADE CONSTRAINTS;
CREATE TABLE QualityModel (
 qualityModelId INT NOT NULL PRIMARY KEY,
 modelName VARCHAR(10),
 modelDescriptionReference INT
);


DROP TABLE Resource CASCADE CONSTRAINTS;
CREATE TABLE Resource (
 resourceId INT NOT NULL PRIMARY KEY,
 resourceName VARCHAR(128),
 resourceType VARCHAR(16),
 resourceAddress VARCHAR(1024)
);


DROP TABLE Time CASCADE CONSTRAINTS;
CREATE TABLE Time (
 valueTime TIMESTAMP(6) NOT NULL PRIMARY KEY
);


DROP TABLE Action CASCADE CONSTRAINTS;
CREATE TABLE Action (
 actionId INT NOT NULL PRIMARY KEY,
 actuatorId INT NOT NULL,
 resourceId INT NOT NULL,
 actionName VARCHAR(128),

 FOREIGN KEY (actuatorId) REFERENCES Actuator (actuatorId),
 FOREIGN KEY (resourceId) REFERENCES Resource (resourceId)
);


DROP TABLE Configuration CASCADE CONSTRAINTS;
CREATE TABLE Configuration (
 actionId INT NOT NULL PRIMARY KEY,
 keyName VARCHAR(128),
 domain VARCHAR(1024),

 FOREIGN KEY (actionId) REFERENCES Action (actionId)
);


DROP TABLE Metric CASCADE CONSTRAINTS;
CREATE TABLE Metric (
 metricId INT NOT NULL PRIMARY KEY,
 qualityModelId INT NOT NULL,
 normalizationKind VARCHAR(10),
 metricName VARCHAR(10),
 metricAggregationOperator INT,
 threshold DOUBLE PRECISION,
 blockLevel INT,

 FOREIGN KEY (qualityModelId) REFERENCES QualityModel (qualityModelId)
);


DROP TABLE Plan CASCADE CONSTRAINTS;
CREATE TABLE Plan (
 planId INT NOT NULL PRIMARY KEY,
 metricId INT NOT NULL,
 valueTime TIMESTAMP(6) NOT NULL,
 qualityModelId INT NOT NULL,
 status INT
);


DROP TABLE ActionPlan CASCADE CONSTRAINTS;
CREATE TABLE ActionPlan (
 planId INT NOT NULL,
 actionId INT NOT NULL,
 executionOrder INT,
 status INT,

 PRIMARY KEY (planId,actionId),

 FOREIGN KEY (planId) REFERENCES Plan (planId),
 FOREIGN KEY (actionId) REFERENCES Action (actionId)
);


DROP TABLE ConfigurationData CASCADE CONSTRAINTS;
CREATE TABLE ConfigurationData (
 planId INT NOT NULL,
 actionId INT NOT NULL,
 value VARCHAR(1024),

 PRIMARY KEY (planId,actionId),

 FOREIGN KEY (planId) REFERENCES Plan (planId),
 FOREIGN KEY (actionId) REFERENCES Action (actionId)
);


DROP TABLE MetricData CASCADE CONSTRAINTS;
CREATE TABLE MetricData (
 metricId INT NOT NULL,
 valueTime TIMESTAMP(10) NOT NULL,
 qualityModelId INT NOT NULL,
 value DOUBLE PRECISION,
 resourceId INT NOT NULL,

 PRIMARY KEY (metricId,valueTime,qualityModelId),

 FOREIGN KEY (metricId) REFERENCES Metric (metricId),
 FOREIGN KEY (valueTime) REFERENCES Time (valueTime),
 FOREIGN KEY (qualityModelId) REFERENCES QualityModel (qualityModelId)
);


DROP TABLE MetricComponent CASCADE CONSTRAINTS;
CREATE TABLE MetricComponent (
 descriptionId INT NOT NULL,
 metricId INT NOT NULL,
 qualityModelId INT NOT NULL,
 attributeAggregationOperator INT,
 numSamples INT,
 weight DOUBLE PRECISION,

 PRIMARY KEY (descriptionId,metricId,qualityModelId),

 FOREIGN KEY (descriptionId) REFERENCES Description (descriptionId),
 FOREIGN KEY (metricId) REFERENCES Metric (metricId),
 FOREIGN KEY (qualityModelId) REFERENCES QualityModel (qualityModelId)
);


DROP TABLE Data CASCADE CONSTRAINTS;
CREATE TABLE Data (
 probeId INT NOT NULL,
 descriptionId INT NOT NULL,
 resourceId INT NOT NULL,
 valueTime TIMESTAMP(6) NOT NULL,
 value DOUBLE PRECISION,

 PRIMARY KEY (probeId,descriptionId,resourceId,valueTime),

 FOREIGN KEY (probeId) REFERENCES Probe (probeId),
 FOREIGN KEY (descriptionId) REFERENCES Description (descriptionId),
 FOREIGN KEY (resourceId) REFERENCES Resource (resourceId),
 FOREIGN KEY (valueTime) REFERENCES Time (valueTime)
);



